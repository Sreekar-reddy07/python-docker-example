# Stage 1: Build Stage
FROM ubuntu:20.04 AS builder

# Install OpenJDK 11 and Maven
RUN apt-get update && \
    apt-get install -y openjdk-11-jdk maven && \
    apt-get clean;

# Set working directory
WORKDIR /app

# Copy the pom.xml and source code to the container
COPY pom.xml .
COPY src/ ./src/

# Install dependencies and build the Java application
RUN mvn clean package

# Stage 2: Run Stage
FROM gcr.io/distroless/java:11

# Set working directory for the runtime container
WORKDIR /app

# Copy the jar file from the build stage
COPY --from=builder /app/target/calculator-1.0-SNAPSHOT.jar /app/calculator.jar

# Command to run the app
CMD ["calculator.jar"]

